<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1"/>
  <title>Travel Survey</title>
  <link rel="stylesheet" href="/static/css/styles.css"/>
</head>
<body>
  <div class="app-layout">
    <!-- Sidebar -->
    <aside class="sidebar">
      <div class="sidebar-header">
        <h2>Projects</h2>
        <button id="new-project-btn" class="btn-new-project" type="button">+ New Project</button>
      </div>
      
      <!-- New Project Form (hidden by default) -->
      <div id="new-project-form" class="new-project-form" style="display: none;">
        <input type="text" id="new-project-name" placeholder="Enter project name" class="project-input"/>
        <div class="form-actions">
          <button type="button" id="create-project-btn" class="btn-create">Create</button>
          <button type="button" id="cancel-project-btn" class="btn-cancel">Cancel</button>
        </div>
      </div>

      <!-- Projects List -->
      <div class="projects-list" id="projects-list">
        {% if projects %}
          {% for project in projects %}
          <div class="project-item {% if selected_project == project.safe_name %}active{% endif %}" 
               data-project="{{ project.safe_name }}" 
               data-project-name="{{ project.name }}">
            <span class="project-name">{{ project.name }}</span>
            <div class="project-item-actions">
              <span class="project-badge" id="count-{{ project.safe_name }}">0</span>
              <div class="dropdown-menu-container">
                <button class="dropdown-trigger" type="button" aria-label="Project options">
                  <span class="three-dots">â‹¯</span>
                </button>
                <div class="dropdown-menu">
                  <button class="dropdown-item delete-project" data-project="{{ project.safe_name }}" data-project-name="{{ project.name }}">Delete Project</button>
                </div>
              </div>
            </div>
          </div>
          {% endfor %}
        {% else %}
          <div class="empty-state">No projects yet. Create one to get started!</div>
        {% endif %}
      </div>
    </aside>

    <!-- Main Content -->
    <main class="main-content">
      <div class="container">
        <!-- Empty State (shown when no projects exist) -->
        {% if not projects %}
        <div id="empty-state-container" class="empty-state-container">
          <div class="empty-state-content">
            <h1>Welcome to PackVote!</h1>
            <p class="muted">Get started by creating your first project.</p>
            <button id="create-first-project-btn" class="btn-primary-large" type="button">
              Create Your First Project
            </button>
          </div>
        </div>
        {% endif %}

        <!-- Participants List View (shown when project is selected) -->
        <div id="participants-container" {% if not selected_project %}style="display: none;"{% endif %}>
          <div class="participants-header">
            <div>
              <h1 id="participants-project-name">
                {% if selected_project %}
                  {% for project in projects %}
                    {% if project.safe_name == selected_project %}
                      {{ project.name }}
                    {% endif %}
                  {% endfor %}
                {% endif %}
              </h1>
              <p class="muted" id="participants-count">0 participants</p>
            </div>
            <button id="add-participant-btn" class="btn-add-participant" type="button">
              <span>+</span> Add Participant
            </button>
          </div>

          <div class="participants-table-container">
            <table class="participants-table" id="participants-table">
              <thead>
                <tr>
                  <th>Name</th>
                  <th>Location</th>
                  <th>Budget</th>
                  <th>Travel Date</th>
                  <th>Duration</th>
                  <th>Preferences</th>
                  <th>Date Added</th>
                  <th></th>
                </tr>
              </thead>
              <tbody id="participants-tbody">
                <!-- Participants will be loaded via JavaScript -->
              </tbody>
            </table>
            <div id="participants-empty" class="participants-empty" style="display: none;">
              <p>No participants yet. Click "Add Participant" to get started!</p>
            </div>
          </div>
        </div>

        <!-- Survey Form (hidden initially if no projects) -->
        <div id="survey-form-container" style="display: none;">
          <form id="survey-form" method="post" action="/submit">
          <!-- Hidden project name field (populated by selected project) -->
          <input type="hidden" id="project_name" name="project_name" value="{% if selected_project %}{{ selected_project }}{% endif %}"/>
          
          <!-- Project Display (read-only) -->
          <div class="field card">
            <label>Current Project</label>
            <div class="project-display" id="current-project-display">
              {% if selected_project %}
                {% for project in projects %}
                  {% if project.safe_name == selected_project %}
                    <strong>{{ project.name }}</strong>
                  {% endif %}
                {% endfor %}
              {% else %}
                <span class="muted">No project selected</span>
              {% endif %}
            </div>
            <div class="note">Select a project from the sidebar to add members.</div>
          </div>

          <!-- Basic info -->
          <div class="grid grid-2">
            <div class="field card">
              <label for="name">Name</label>
              <input id="name" name="name" type="text" placeholder="Alex Doe" required/>
            </div>
            <div class="field card">
              <label for="phone">Phone</label>
              <div class="phone-input-group">
                <select id="country_code" name="country_code" class="country-code-select" required>
                  <option value="+1">ðŸ‡ºðŸ‡¸ +1</option>
                  <option value="+44">ðŸ‡¬ðŸ‡§ +44</option>
                  <option value="+91">ðŸ‡®ðŸ‡³ +91</option>
                  <option value="+86">ðŸ‡¨ðŸ‡³ +86</option>
                  <option value="+81">ðŸ‡¯ðŸ‡µ +81</option>
                  <option value="+49">ðŸ‡©ðŸ‡ª +49</option>
                  <option value="+33">ðŸ‡«ðŸ‡· +33</option>
                  <option value="+39">ðŸ‡®ðŸ‡¹ +39</option>
                  <option value="+34">ðŸ‡ªðŸ‡¸ +34</option>
                  <option value="+61">ðŸ‡¦ðŸ‡º +61</option>
                  <option value="+55">ðŸ‡§ðŸ‡· +55</option>
                  <option value="+52">ðŸ‡²ðŸ‡½ +52</option>
                  <option value="+7">ðŸ‡·ðŸ‡º +7</option>
                  <option value="+82">ðŸ‡°ðŸ‡· +82</option>
                  <option value="+65">ðŸ‡¸ðŸ‡¬ +65</option>
                  <option value="+971">ðŸ‡¦ðŸ‡ª +971</option>
                  <option value="+966">ðŸ‡¸ðŸ‡¦ +966</option>
                  <option value="+27">ðŸ‡¿ðŸ‡¦ +27</option>
                  <option value="+31">ðŸ‡³ðŸ‡± +31</option>
                  <option value="+46">ðŸ‡¸ðŸ‡ª +46</option>
                  <option value="+47">ðŸ‡³ðŸ‡´ +47</option>
                  <option value="+41">ðŸ‡¨ðŸ‡­ +41</option>
                  <option value="+32">ðŸ‡§ðŸ‡ª +32</option>
                  <option value="+351">ðŸ‡µðŸ‡¹ +351</option>
                  <option value="+353">ðŸ‡®ðŸ‡ª +353</option>
                  <option value="+358">ðŸ‡«ðŸ‡® +358</option>
                  <option value="+45">ðŸ‡©ðŸ‡° +45</option>
                  <option value="+48">ðŸ‡µðŸ‡± +48</option>
                  <option value="+90">ðŸ‡¹ðŸ‡· +90</option>
                  <option value="+20">ðŸ‡ªðŸ‡¬ +20</option>
                  <option value="+234">ðŸ‡³ðŸ‡¬ +234</option>
                  <option value="+254">ðŸ‡°ðŸ‡ª +254</option>
                  <option value="+60">ðŸ‡²ðŸ‡¾ +60</option>
                  <option value="+66">ðŸ‡¹ðŸ‡­ +66</option>
                  <option value="+62">ðŸ‡®ðŸ‡© +62</option>
                  <option value="+63">ðŸ‡µðŸ‡­ +63</option>
                  <option value="+84">ðŸ‡»ðŸ‡³ +84</option>
                  <option value="+64">ðŸ‡³ðŸ‡¿ +64</option>
                  <option value="+1">ðŸ‡¨ðŸ‡¦ +1</option>
                </select>
                <input id="phone" name="phone" type="tel" placeholder="5551234567" 
                       pattern="[0-9]{10}" required/>
              </div>
              <div class="note">Enter 10-digit phone number (digits only).</div>
              <div id="phone-warning" class="phone-warning" style="display: none;">
                Phone number must be exactly 10 digits
              </div>
            </div>
          </div>

          <div class="field card">
            <label for="current_location">Current Location</label>
            <input id="current_location" name="current_location" type="text" placeholder="Austin, TX" required/>
          </div>

          <!-- Budget -->
          <div class="card" id="budget-card"
               data-budgets='{{ budget_cards | tojson }}'>
            <label>What is Your Budget?</label>
            <div class="grid grid-3" id="budget-cards">
              {% for k, v in budget_cards.items() %}
              <label class="pill" data-budget="{{ k }}">
                <input type="radio" name="budget_category" value="{{ k }}"/>
                <div>
                  <div class="title">{{ v.label }}</div>
                  <div class="sub">
                    {% if k == 3 %}
                      {{ v.range[0] }}+ USD
                    {% else %}
                      {{ v.range[0] }} â€“ {{ v.range[1] }} USD
                    {% endif %}
                  </div>
                </div>
              </label>
              {% endfor %}
            </div>
            <input type="hidden" id="budget_range" name="budget_range"/>
            <div class="note">Budget is for activities & dining.</div>
          </div>

          <!-- Date & Duration -->
          <div class="card">
            <label>When are you planning to travel?</label>
            <div class="date-picker-container">
              <input type="hidden" id="travel_date" name="travel_date" required/>
              <button type="button" id="travel_date_trigger" class="date-picker-trigger">
                <span id="travel_date_display">Select date</span>
                <span class="date-picker-icon">ðŸ“…</span>
              </button>
              <div id="travel_date_dropdown" class="date-picker-dropdown" style="display: none;">
                <div class="date-picker-header">
                  <select id="travel_date_month" class="date-picker-select">
                    <option value="0">January</option>
                    <option value="1">February</option>
                    <option value="2">March</option>
                    <option value="3">April</option>
                    <option value="4">May</option>
                    <option value="5">June</option>
                    <option value="6">July</option>
                    <option value="7">August</option>
                    <option value="8">September</option>
                    <option value="9">October</option>
                    <option value="10">November</option>
                    <option value="11">December</option>
                  </select>
                  <select id="travel_date_year" class="date-picker-select"></select>
                </div>
                <div class="date-picker-calendar">
                  <div class="date-picker-weekdays">
                    <div>Sun</div>
                    <div>Mon</div>
                    <div>Tue</div>
                    <div>Wed</div>
                    <div>Thu</div>
                    <div>Fri</div>
                    <div>Sat</div>
                  </div>
                  <div id="travel_date_days" class="date-picker-days"></div>
                </div>
              </div>
            </div>
            <div style="height:18px"></div>
            <label>How many days are you planning to travel?</label>
            <div class="row">
              <div class="stepper">
                <button type="button" id="minus">âˆ’</button>
                <input id="travel_duration" name="travel_duration" type="number" value="3" min="1" max="60" style="width:90px; text-align:center"/>
                <button type="button" id="plus">+</button>
              </div>
            </div>
          </div>

          <!-- Preferences -->
          <div class="card" id="prefs-card" data-prefs='{{ preferences | tojson }}'>
            <label>Preferences</label>
            <div class="prefs" id="pref-grid">
              {% for p in preferences %}
              <label class="pref">
                <input type="checkbox" name="preferences" value="{{ p }}"/>
                <div>{{ p }}</div>
              </label>
              {% endfor %}
            </div>
          </div>

          <button class="submit" type="submit">Add Participant</button>
        </form>
        </div>
      </div>
    </main>
  </div>

  <!-- Modal for Project Creation -->
  <div id="project-modal" class="modal" style="display: none;">
    <div class="modal-overlay"></div>
    <div class="modal-content">
      <h2>Create New Project</h2>
      <p class="modal-message">Enter project name. Start adding members.</p>
      <input type="text" id="modal-project-name" placeholder="Enter project name" class="modal-input" autofocus/>
      <div class="modal-actions">
        <button type="button" id="modal-create-btn" class="btn-modal-create">Create Project</button>
        <button type="button" id="modal-cancel-btn" class="btn-modal-cancel">Cancel</button>
      </div>
    </div>
  </div>

  <!-- Modal for Participant Form -->
  <div id="participant-form-modal" class="modal" style="display: none;">
    <div class="modal-overlay"></div>
    <div class="modal-content modal-content-large">
      <h2>Add New Participant</h2>
      <p class="modal-message">Fill this quick survey so we can tailor your trip.</p>
      
      <form id="participant-form" method="post" action="/submit">
        <input type="hidden" id="form-project-name" name="project_name" value=""/>
        
        <div class="grid grid-2">
          <div class="field">
            <label for="form-name">Name</label>
            <input id="form-name" name="name" type="text" placeholder="Alex Doe" required/>
          </div>
          <div class="field">
            <label for="form-phone">Phone</label>
            <div class="phone-input-group">
              <select id="form-country_code" name="country_code" class="country-code-select" required>
                <option value="+1">ðŸ‡ºðŸ‡¸ +1</option>
                <option value="+44">ðŸ‡¬ðŸ‡§ +44</option>
                <option value="+91">ðŸ‡®ðŸ‡³ +91</option>
                <option value="+86">ðŸ‡¨ðŸ‡³ +86</option>
                <option value="+81">ðŸ‡¯ðŸ‡µ +81</option>
                <option value="+49">ðŸ‡©ðŸ‡ª +49</option>
                <option value="+33">ðŸ‡«ðŸ‡· +33</option>
                <option value="+39">ðŸ‡®ðŸ‡¹ +39</option>
                <option value="+34">ðŸ‡ªðŸ‡¸ +34</option>
                <option value="+61">ðŸ‡¦ðŸ‡º +61</option>
                <option value="+55">ðŸ‡§ðŸ‡· +55</option>
                <option value="+52">ðŸ‡²ðŸ‡½ +52</option>
                <option value="+7">ðŸ‡·ðŸ‡º +7</option>
                <option value="+82">ðŸ‡°ðŸ‡· +82</option>
                <option value="+65">ðŸ‡¸ðŸ‡¬ +65</option>
                <option value="+971">ðŸ‡¦ðŸ‡ª +971</option>
                <option value="+966">ðŸ‡¸ðŸ‡¦ +966</option>
                <option value="+27">ðŸ‡¿ðŸ‡¦ +27</option>
                <option value="+31">ðŸ‡³ðŸ‡± +31</option>
                <option value="+46">ðŸ‡¸ðŸ‡ª +46</option>
                <option value="+47">ðŸ‡³ðŸ‡´ +47</option>
                <option value="+41">ðŸ‡¨ðŸ‡­ +41</option>
                <option value="+32">ðŸ‡§ðŸ‡ª +32</option>
                <option value="+351">ðŸ‡µðŸ‡¹ +351</option>
                <option value="+353">ðŸ‡®ðŸ‡ª +353</option>
                <option value="+358">ðŸ‡«ðŸ‡® +358</option>
                <option value="+45">ðŸ‡©ðŸ‡° +45</option>
                <option value="+48">ðŸ‡µðŸ‡± +48</option>
                <option value="+90">ðŸ‡¹ðŸ‡· +90</option>
                <option value="+20">ðŸ‡ªðŸ‡¬ +20</option>
                <option value="+234">ðŸ‡³ðŸ‡¬ +234</option>
                <option value="+254">ðŸ‡°ðŸ‡ª +254</option>
                <option value="+60">ðŸ‡²ðŸ‡¾ +60</option>
                <option value="+66">ðŸ‡¹ðŸ‡­ +66</option>
                <option value="+62">ðŸ‡®ðŸ‡© +62</option>
                <option value="+63">ðŸ‡µðŸ‡­ +63</option>
                <option value="+84">ðŸ‡»ðŸ‡³ +84</option>
                <option value="+64">ðŸ‡³ðŸ‡¿ +64</option>
                <option value="+1">ðŸ‡¨ðŸ‡¦ +1</option>
              </select>
              <input id="form-phone" name="phone" type="tel" placeholder="5551234567" 
                     pattern="[0-9]{10}" required/>
            </div>
            <div class="note">Enter 10-digit phone number (digits only).</div>
            <div id="form-phone-warning" class="phone-warning" style="display: none;">
              Phone number must be exactly 10 digits
            </div>
          </div>
        </div>

        <div class="field">
          <label for="form-current_location">Current Location</label>
          <input id="form-current_location" name="current_location" type="text" placeholder="Austin, TX" required/>
        </div>

        <div class="card" id="form-budget-card" data-budgets='{{ budget_cards | tojson }}'>
          <label>What is Your Budget?</label>
          <div class="grid grid-3" id="form-budget-cards">
            {% for k, v in budget_cards.items() %}
            <label class="pill" data-budget="{{ k }}">
              <input type="radio" name="budget_category" value="{{ k }}"/>
              <div>
                <div class="title">{{ v.label }}</div>
                <div class="sub">
                  {% if k == 3 %}
                    {{ v.range[0] }}+ USD
                  {% else %}
                    {{ v.range[0] }} â€“ {{ v.range[1] }} USD
                  {% endif %}
                </div>
              </div>
            </label>
            {% endfor %}
          </div>
          <input type="hidden" id="form-budget_range" name="budget_range"/>
        </div>

        <div class="card">
          <label>When are you planning to travel?</label>
          <div class="date-picker-container">
            <input type="hidden" id="form-travel_date" name="travel_date" required/>
            <button type="button" id="form-travel_date_trigger" class="date-picker-trigger">
              <span id="form-travel_date_display">Select date</span>
              <span class="date-picker-icon">ðŸ“…</span>
            </button>
            <div id="form-travel_date_dropdown" class="date-picker-dropdown" style="display: none;">
              <div class="date-picker-header">
                <select id="form-travel_date_month" class="date-picker-select">
                  <option value="0">January</option>
                  <option value="1">February</option>
                  <option value="2">March</option>
                  <option value="3">April</option>
                  <option value="4">May</option>
                  <option value="5">June</option>
                  <option value="6">July</option>
                  <option value="7">August</option>
                  <option value="8">September</option>
                  <option value="9">October</option>
                  <option value="10">November</option>
                  <option value="11">December</option>
                </select>
                <select id="form-travel_date_year" class="date-picker-select"></select>
              </div>
              <div class="date-picker-calendar">
                <div class="date-picker-weekdays">
                  <div>Sun</div>
                  <div>Mon</div>
                  <div>Tue</div>
                  <div>Wed</div>
                  <div>Thu</div>
                  <div>Fri</div>
                  <div>Sat</div>
                </div>
                <div id="form-travel_date_days" class="date-picker-days"></div>
              </div>
            </div>
          </div>
          <div style="height:18px"></div>
          <label>How many days are you planning to travel?</label>
          <div class="row">
            <div class="stepper">
              <button type="button" id="form-minus">âˆ’</button>
              <input id="form-travel_duration" name="travel_duration" type="number" value="3" min="1" max="60" style="width:90px; text-align:center"/>
              <button type="button" id="form-plus">+</button>
            </div>
          </div>
        </div>

        <div class="card" id="form-prefs-card" data-prefs='{{ preferences | tojson }}'>
          <label>Preferences</label>
          <div class="prefs" id="form-pref-grid">
            {% for p in preferences %}
            <label class="pref">
              <input type="checkbox" name="preferences" value="{{ p }}"/>
              <div>{{ p }}</div>
            </label>
            {% endfor %}
          </div>
        </div>

        <div class="modal-actions">
          <button type="submit" class="btn-modal-create">Add Participant</button>
          <button type="button" id="form-cancel-btn" class="btn-modal-cancel">Cancel</button>
        </div>
      </form>
    </div>
  </div>

  <script src="/static/js/main.js"></script>
</body>
</html>
